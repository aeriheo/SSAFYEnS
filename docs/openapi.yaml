openapi: 3.0.1
info:
  title: S05P12A109
  description: |-
    * 읽으실때 복수형 구분에 유의하세요! 실수했을 수도 있으니 어? 얜 array인데 왜 단수형이 붙어있지나 vice versa 알려주세요
    * 각 회원의 정보(user_id)는 jwt를 통해 취득합니다. headers["access_token"]으로 보내주세요
    * response의 코드 등도 제대로 되어있지 않으니, 클라이언트측 parameter와 requestbody(JSON), 그리고 서버측 response JSON 위주로 확인바랍니다
    * 200이 아닌 response는 굳이 필요한가요? 네 필요합니다. error를 JSON으로 보내줄지는 합의 필요.
    * operationId는 CRUD를 따서 create, get(read아닙니다), update, delete와 parameter를 사용하는 경우 By{parameter}를 뒤에 붙였습니다. (예외 checkGroupName 등)
    * 0729 논의해본 결과 schedule에 일, 주, 월, 년?을 넣어서 쉽게 접근할 수 있도록 바꿨습니다. 혹시 날짜와 관련된 내용인데 schedule을 참조($ref)하고 있지 않으면 제보바랍니다
    * required가 문제를 일으키는 것 같아 path parameter를 제외하고 required는 전부 주석처리했습니다
    * schedule에 expectstart_at 시작예정시각 속성을 추가했습니다
    * ReqeustBody, Response는 모두 application/json으로 통일합니다.
    * 0806 합의로 daily, weekly, monthly, yearly에 변화가 생겼습니다
    * schedule의 내용(context)와 daily의 일간 평가(context)에 혼동이 자주 발생하는 것 같아 daily의 경우 daily_context로 변경하였습니다
    * DELETE /average/daily/{date}는 삭제했습니다. 일간 평가(daily_context)를 지우고자 하는 경우 POST(사실 이거도 PUT이어야...)를 활용하세요.
    * 0809 합의로 schedule notification은 일정 시작 전의 알림으로 간주합니다.
    * 마이페이지에서 "얻을 수 있는 트로피" 페이지 같은게 있으면 좋을 것 같습니다???
    * trophy와 관련된 API들이 변경되었습니다. `user/~~~~~`에서 `trophy/~~~~~~`로 모두 변경, 이동했습니다
    * created_at고 updated_at은 POST/PUT requestBody로 보내시면 안 됩니다. 
  # termsOfService: http://swagger.io/terms/
  # contact:
  #   email: apiteam@swagger.io
#   license:
#     name: Apache 2.0
#     url: http://www.apache.org/licenses/LICENSE-2.0.html
  version: 1.0.2
# externalDocs:
#   description: Find out more about Swagger
#   url: http://swagger.io
servers:
- url: http://localhost:8079
- url: https://i5a109.p.ssafy.io:8079
- url: http://i5a109.p.ssafy.io:8079
tags:
- name: schedule
  description: Everything about your schedules
  # externalDocs:
  #   description: Find out more
  #   url: http://swagger.io
# - name: store
#   description: Access to Schedules
- name: user
  description: Operations about user
- name: trophy
  description: Operations about trophy
- name: average
  description: |-
    * 통계를 위한 내용입니다
- name: group
  description: |-
    * 그룹에 관한 내용입니다.
  # externalDocs:
  #   description: Find out more about our store
  #   url: http://swagger.io
    
paths:

  /schedule:
  
    post:
      tags:
      - schedule
      summary: Add a new schedule to user
      description: |-
        * schedule_id, user_id, finished_at, created_at, updated_at, point, is_finished, noti_extend는 불필요
        * date, title, context, started_at, deadline_at, notification, notificationtime만 받으면 되는 것 같은데?
        * schedule에 date, week, month 정보를 넣어놓으면 한 번에 조회 가능해서 간편해질 듯 하다.
        * schedule이 만들어질 때는 그에 해당하는 date, week, month, year instance는 생성되어야한다. (하지만 is_finished될 때까지는 sum, cnt 계산에 포함하지 않는다)
      operationId: createSchedule
      requestBody:
        # required: true
        description: Schedule object that needs to be added to the user
        content:
          application/json:
            schema:
              properties:
                # $ref: '#/components/schemas/schedule'
                # 제외해야할 properties 발생
                date:
                  $ref: '#/components/schemas/schedule/properties/date'
                title:
                  $ref: '#/components/schemas/schedule/properties/title'
                context:
                  $ref: '#/components/schemas/schedule/properties/context'
                expectstart_at:
                  $ref: '#/components/schemas/schedule/properties/expectstart_at'
                # started_at:
                #   $ref: '#/components/schemas/schedule/properties/started_at'
                deadline_at:
                  $ref: '#/components/schemas/schedule/properties/deadline_at'
                notification:
                  $ref: '#/components/schemas/schedule/properties/notification'
                notificationtime:
                  $ref: '#/components/schemas/schedule/properties/notificationtime'
                
      responses:
        200:
          $ref: '#/components/responses/200schedule'
        # 200:
        #   description: 'successful operation: 해당 일정의 정보를 돌려줌'
        #   content:
        #     application/json:
        #       schema:
        #         $ref: '#/components/schemas/schedule'
                
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        404:
          $ref: '#/components/responses/404'
          
      security:
      - JWT: []
      
  /schedule/{schedule_id}:
  
    get:
      tags:
      - schedule
      summary: Find schedule by ID
      description: Returns a single schedule
      operationId: getScheduleById
      parameters:
      - name: schedule_id
        in: path
        description: ID of schedule to return
        required: true
        schema:
          type: integer
      responses:
        200:
          $ref: '#/components/responses/200schedule'
        400:
          description: Invalid ID supplied
          content: {}
        404:
          description: Schedule not found
          content: {}
      security:
      - JWT: []
      
    put:
      tags:
      - schedule
      summary: Updates a schedule with JSON data
      operationId: updateScheduleById
      description: |- 
        * 일정을 (완료이전) 수정, 완료, (완료이후) 수정하는 것 모두 여기에서 이루어짐. 현재는 모든 값을 보낼 수 있지만 FE에서 적절히 보내기
        * 완료된 일정을 수정할 수 있어야하는가???
        * **그래서 합의에 따라 is_finished==true인 경우는 PUT 요청을 거절(에러 반환)합니다.**
        ---
        * 이하 폐기
        * PUT요청에서 is_finished가 true->false로 가는 경우... 막아주세요(FE)
        * PUT요청에 (is_finished가 true면) daily/weekly/monthly/yearly 업데이트 필요
        * 만약 다른 날짜로 update한다면, 사실상 `POST /schedule`과 동일.
        * 하지만 과거로 update한다면 수정사항이 매우 많을 것 같다. (sum, cnt 등)
        

      parameters:
      - name: schedule_id
        in: path
        description: ID of schedule that needs to be updated
        required: true
        schema:
          type: integer
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/schedule'
              # =======================================
              # properties:
                # title:
                #   $ref: '#/components/schemas/schedule/properties/title'
                # context:
                #   $ref: '#/components/schemas/schedule/properties/context'
                # expectstart_at:
                #   $ref: '#/components/schemas/schedule/properties/expectstart_at'
                # deadline_at:
                #   $ref: '#/components/schemas/schedule/properties/deadline_at'
                # point:
                #   $ref: '#/components/schemas/schedule/properties/point'
                # is_finished:
                #   $ref: '#/components/schemas/schedule/properties/is_finished'
                # notification:
                #   $ref: '#/components/schemas/schedule/properties/notification'
                # notificationtime:
                #   $ref: '#/components/schemas/schedule/properties/notificationtime'
                # noti_extend:
                #   $ref: '#/components/schemas/schedule/properties/noti_extend'
                # humidity:
                #   $ref: '#/components/schemas/schedule/properties/humidity'
                # illuminance:
                #   $ref: '#/components/schemas/schedule/properties/illuminance'
                # noise:
                #   $ref: '#/components/schemas/schedule/properties/noise'
                # temperature:
                #   $ref: '#/components/schemas/schedule/properties/temperature'
                
      responses:
        200:
          $ref: '#/components/responses/200schedule'
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        404:
          $ref: '#/components/responses/404'
      security:
      - JWT: []
      
    delete:
      tags:
      - schedule
      summary: Deletes a schedule
      operationId: deleteScheduleById
      parameters:
      - name: schedule_id
        in: path
        description: Schedule id to delete
        required: true
        schema:
          type: integer
      responses:
        400:
          description: Invalid ID supplied
          content: {}
        404:
          description: Schedule not found
          content: {}
      security:
      - JWT: []
      
  /schedule/month/{date}:
    get:
      tags:
      - schedule
      summary: Get all schedules of user of specific month
      operationId: getScheduleByMonth
      parameters:
      - name: date
        in: path
        description: date 형식으로 받지만 년도, 월만 반영합니다
        required: true
        schema:
          type: string
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/schedule'
      security:
      - JWT: []

  /user/duplicatecheckid/{user_id}:
  
    get:
      tags:
      - user
      summary: Duplicate check by user_id
      operationId: getDuplicateCheckById
      description: '200응답이 오면 괜찮고 400번대 응답이 오면 중복입니다'
      parameters:
      - in: path
        name: user_id
        required: true
        schema:
          $ref: "#/components/schemas/user/properties/user_id"
      responses:
        200:
          description: OK
        404:
          description: Not Found

  /user/duplicatecheckemail/{email}:
  
    get:
      tags:
      - user
      summary: Duplicate check by email
      operationId: getDuplicateCheckByEmail
      description: '200응답이 오면 괜찮고 400번대 응답이 오면 중복입니다'
      parameters:
      - in: path
        name: email
        required: true
        schema:
          $ref: "#/components/schemas/user/properties/email"
      responses:
        200:
          description: OK
        404:
          description: Not Found
          
  /user/duplicatecheckcellphone/{cellphone}:
  
    get:
      tags:
      - user
      summary: Duplicate check by cellphone
      operationId: getDuplicateCheckByCellphone
      description: '200응답이 오면 괜찮고 400번대 응답이 오면 중복입니다'
      parameters:
      - in: path
        name: cellphone
        required: true
        schema:
          $ref: "#/components/schemas/user/properties/cellphone"
      responses:
        200:
          description: OK
        404:
          description: Not Found
          
  /user:
  
    get:
      tags:
      - user
      summary: '[TEST] Get All Users (관리자 페이지용)'
      description: |-
        * 모든 유저 정보를 가져옵니다.
        * 각 유저가 가진 트로피, 가입(신청)한 그룹의 목록은 가져오지 않습니다.
      operationId: getUserAll
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/user'

      
  
    post:
      tags:
      - user
      summary: Create user
      description: |-
        * 유저를 생성할 때는 id, name, email, cellphone, password 만 받으면 될 것
        * user_id, email, cellphone 중복 확인 여부는 FE에서 
        * password는 bcrypt를 사용함
      operationId: createUser
      requestBody:
        description: Created user object
        # required: true
        content:
          application/json:
            schema:
              properties:
                user_id:
                  $ref: '#/components/schemas/user/properties/user_id'
                name:
                  $ref: '#/components/schemas/user/properties/name'
                email:
                  $ref: '#/components/schemas/user/properties/email'
                cellphone:
                  $ref: '#/components/schemas/user/properties/cellphone'
                password:
                  $ref: '#/components/schemas/user/properties/password'
        
              # $ref: '#/components/schemas/user'
              # 제외해야할 항목들이 생김
      responses:
        200:
          $ref: '#/components/responses/200user'
      
  /user/id:
  
    post:
      tags:
      - user
      summary: returns user_id info
      description: 아이디 찾기
      operationId: findId
      # parameters:
      # - name: name
      #   in: query
      #   description: 이름
      #   # required: true
      #   schema:
      #     type: string
      # - name: email
      #   in: query
      #   description: 이메일
      #   # required: true
      #   schema:
      #     type: string
      requestBody:
        description: 이름, 이메일
        content:
          application/json:
            schema:
              properties:
                name:
                  $ref: '#/components/schemas/user/properties/name'
                email:
                  $ref: '#/components/schemas/user/properties/email'
      responses:
        200:
          description: OK // 결과가 없으면 비어있는 JSON이 오게 됨
          content:
            application/json:
              schema:
                properties:
                  user_id:
                    $ref: '#/components/schemas/user/properties/user_id'
                
      
    
    
  /user/password:
    
    post:
      tags:
      - user
      summary: 비밀번호 재설정 인증(get은 requestbody말고 path, query)
      description: |-
        * 정보가 모두 일치하면 해당되는 회원 정보를 돌려줍니다. (향후 정보수정 페이지에서 업데이트 하는 경우의 확장성을 위해) 
        * 해당하는 회원이 없는 경우 {}를 반환합니다.
      operationId: validatePasswordRenew
      # parameters:
      # - name: name
      #   in: query
      #   description: 이름
      #   # required: true
      #   schema:
      #     type: string
      # - name: user_id
      #   in: query
      #   description: 아이디
      #   # required: true
      #   schema:
      #     type: string
      # - name: email
      #   in: query
      #   description: 이메일
      #   # required: true
      #   schema:
      #     type: string
      requestBody:
        description: 이름, 이메일
        content:
          application/json:
            schema:
              properties:
                name:
                  $ref: '#/components/schemas/user/properties/name'
                email:
                  $ref: '#/components/schemas/user/properties/email'
                user_id:
                  $ref: '#/components/schemas/user/properties/email'
      responses:
        200:
          $ref: '#/components/responses/200user'
          
    put:
      tags:
      - user
      summary: 비밀번호 재설정
      description: 재설정할 아이디와 비밀번호를 보내면
      operationId: updatePassword
      requestBody:
        description: 재설정할 비밀번호를 보내줍니다 (id정보는 인증 단계에서 이미 가졌다고 가정)
        content:
          application/json:
            schema:
              properties:
                user_id:
                  $ref: '#/components/schemas/user/properties/user_id'
                password:
                  $ref: '#/components/schemas/user/properties/password'
      responses:
        200:
          description: user_id가 정상인 경우
          content:
            application/json:
              schema: 
                properties:
                  result:
                    type: string
                    enum:
                    - Password has been updated
        400:
          description: user_id에 해당하는 회원이 없는 경우
          content:
            application/json:
              schema: 
                properties:
                  result:
                    type: string
                    enum:
                    - Incorrect user_id given
          
          
            
      
  /user/login:
  
    post:
      tags:
      - user
      summary: Logs user into the system
      description: '아이디와 비밀번호를 제공하면  JWT값을 포함한 JSON을 반환합니다'
      operationId: login
      requestBody:
        content:
          application/json:
            schema:
              properties:
                user_id:
                  $ref: "#/components/schemas/user/properties/user_id"
                password:
                  $ref: "#/components/schemas/user/properties/password"
      # parameters:
      # - name: user_id
      #   in: query
      #   description: The user_id for login
      #   required: true
      #   schema:
      #     type: string
      # - name: password
      #   in: query
      #   description: The password for login(그대로? 암호화?)
      #   required: true
      #   schema:
      #     type: string
      responses:
        200:
          description: successful operation
          content:
            application/json:
              schema:
                properties:
                  user_id:
                    $ref: "#/components/schemas/user/properties/user_id"
                  access_token:
                    type: string
                    description: 이건 유효한 값이 아닙니다
                    example: asdklfhalksdhfjkahsdklfhasdfk.asldkjfhlaksjdhlkasdhlfasdjklf.alsdkjfhaksjdhflas
        400:
          description: Invalid username/password supplied
          content: {}
          
  /user/logout:
  
    get:
      tags:
      - user
      summary: Logs out current logged in user session
      operationId: logout
      responses:
        default:
          description: successful operation
          content: {}
      security:
      - JWT: []
          
  /user/{user_id}:
  
    get:
      tags:
      - user
      summary: Get user info by user_id
      operationId: getUserById
      description: |-
        * (미적용) JWT토큰을 통해 본인인 경우에만 조회할 수 있다
        * mytrophies, mygroups
        * mytrophies, mygroups에서는 본인의 획득,가입 시점도 제공하면 좋을 것같다
        * 당연히? 회원이 소유한 트로피만 반환한다
      parameters:
      - in: path
        name: user_id
        required: true
        schema:
          $ref: "#/components/schemas/user/properties/user_id"
      responses:
        200:
          # $ref: '#/components/responses/200user'
          # ======================================
          description: OK
          content:
            application/json:
              schema:
                # $ref: '#/components/schemas/user'
                # ======================================
                allOf:
                - $ref: '#/components/schemas/user'
                - type: object
                  properties:
                    mytrophies:
                      type: array
                      items:
                        $ref: '#/components/schemas/mytrophy'
                    mygroups:
                      description: 회원이 속한 그룹만 반환한다
                      type: array
                      items:
                        $ref: '#/components/schemas/group'
              
        400:
          description: Invalid user_id supplied
          content: {}
        404:
          description: User not found
          content: {}
      security:
      - JWT: []
      
    put:
      tags:
      - user
      summary: Update user
      description: |-
        * This can only be done by the logged in user.
        * (미적용) 회원 본인만 접근할 수 있다
        * 현재 방식은 프론트엔드가 GET으로 갖고 온 정보에 변경될 내용만 override해서 json 형태로 보내주는 것임
        * 합의사항 id는 수정할 수 없고, 이메일과 전화번호는 수정될 수 있다고 생각하여 수정가능 (FE)
        * BE에서는 들어오는 모든 정보를 수정토록 하였으므로, FE가 보내는 값이 중요...
        * **password여기에서 수정하시면 안됩니다!!!** (취지상도 그렇고 귀찮아서 암호화 구현 안해놨어요)
      operationId: updateUserById
      parameters:
      - name: user_id
        in: path
        description: user_id of user that need info to be updated
        required: true
        schema:
          type: string
      requestBody:
        description: Updated user object
        # required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/user'
      responses:
        200:
          $ref: '#/components/responses/200user'
        400:
          description: Invalid user supplied
          content: {}
        404:
          description: User not found
          content: {}
      security:
      - JWT: []
      
    delete:
      tags:
      - user
      summary: Delete user
      description: This can only be done by the logged in user.
      operationId: deleteUserById
      parameters:
      - name: user_id
        in: path
        description: The user that needs to be deleted
        required: true
        schema:
          type: string
      responses:
        200:
          description: User deletion successful
          content: {}
        400:
          description: Invalid user_id supplied
          content: {}
        404:
          description: User not found
          content: {}
      security:
      - JWT: []
      
  /user/{user_id}/exp/{add_exp}:  
    
    post:
      tags:
      - user
      summary: Add exp to user
      description: |-
        * This can only be done by the logged in user.
        * 
      operationId: addExpById
      parameters:
      - name: user_id
        in: path
        description: The user that needs exp to be added
        required: true
        schema:
          type: string
      - name: add_exp
        in: path
        description: The exp to be added
        required: true
        schema:
          type: integer
      responses:
        200:
          description: Point add successful
          content: {}
        400:
          description: Invalid user_id supplied
          content: {}
        404:
          description: User not found
          content: {}
      security:
      - JWT: []
      
    
      
  /average/daily/{date}:
  
    get:
      tags:
      - average
      summary: Get daily information
      description: |-
        * This can only be done by the logged in user
        * 본인의 일간만 가져옴
        * 기존 daily 모델 + 해당되는 모든 schedule도 포함하여 제공함
        * 정말 필요한 정보만 집어넣자는 결론에 따라, 와이어프레임에서 요구하는 정보로 제한했으나, SQL 처리과정에서 시간이 동일하므로 확장성을 위해 모든 정보를 제공함. 
        * 그래프 Y축은 일정의 시간으로 합의했으므로, finished_at - started_at 로 구할 수 있음.그 값을 0~100의 값으로 변환도 가능해보임. 만약 필요하다면 백엔드에서 계산해서 줄 수도 있으므로 리뷰시 정해주세요.
        * 0807 합의로 DB에서는 sum과 cnt를 보관하지만, FE에는 산술평균으로 계산한 avg로 보내드립니다. 
        * schedule의 내용(context)와 daily의 일간 평가(context)에 혼동이 자주 발생하는 것 같아 daily의 경우 daily_context로 변경하였습니다
      operationId: getDailyByDate
      parameters:
      - in: path
        name: date
        required: true
        schema:
          $ref: "#/components/schemas/daily/properties/date"
      responses:
        200:
          description: Comment on daily successful
          content:
            application/json:
              schema:
                # $ref: '#/components/schemas/daily'
                # ====================================
                allOf:
                # - $ref: '#/components/schemas/daily'
                - type: object
                  description: 'response의 schema에만 표출됨'
                  properties:
                    date:
                      $ref: '#/components/schemas/daily/properties/date'
                    week:
                      $ref: '#/components/schemas/daily/properties/week'
                    month:
                      $ref: '#/components/schemas/daily/properties/month'
                    year:
                      $ref: '#/components/schemas/daily/properties/year'
                    user_id:
                      $ref: '#/components/schemas/daily/properties/user_id'
                    daily_context:
                      $ref: '#/components/schemas/daily/properties/daily_context'
                    cnt_schedule:
                      $ref: '#/components/schemas/daily/properties/cnt_schedule'
                    avg_point:
                      $ref: '#/components/schemas/schedule/properties/point'
                    avg_humidity:
                      $ref: '#/components/schemas/schedule/properties/humidity'
                    avg_illuminance:
                      $ref: '#/components/schemas/schedule/properties/illuminance'
                    avg_noise:
                      $ref: '#/components/schemas/schedule/properties/noise'
                    avg_temperature:
                      $ref: '#/components/schemas/schedule/properties/temperature'
                    schedules:
                      type: array
                      items:
                        $ref: '#/components/schemas/schedule'
                        # ========================================
                        # type: object
                        # properties:
                        #   schedule_id:
                        #     $ref: '#/components/schemas/schedule/properties/schedule_id'
                        #   title:
                        #     $ref: '#/components/schemas/schedule/properties/title'
                        #   started_at:
                        #     $ref: '#/components/schemas/schedule/properties/started_at'
                        #   finished_at:
                        #     $ref: '#/components/schemas/schedule/properties/finished_at'
                        #   time:
                        #     type: integer                    
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []

    put:
      tags:
      - average
      summary: Comment on daily
      description: |-
        * This can only be done by the logged in user
        * 본인의 일간에만 작성함
        * POST와PUT중 하나만 있으면 되는거 아닐까요?? 처음에 튜플없을때는 daily, 있으면 put? 근데 프론트엔드에서 그걸 판단하고 보낼 수 있나요? 그냥 post로 통일하고 override하는게 낫지 않을까요? => 네 그래서 put은 삭제하고 post만 남겼습니다. 다시 생각해보니 역시 만드는게 아니라서 PUT으로 해야할거같은데, 의견 주십쇼???
        * 백엔드측 함수명(operationId)는 create로 남겨놓겠습니다만, 이미 존재하는 Date라면 update라고 인지해주시면 감사하겠습니다
        * schedule이 create되면 그에 해당되는 daily, weekly, monthly, yearly가 없는 경우 create되고,
        * schedule이 update되면 그에 해당되는 daily, weekly, monthly, yearly의 sum, cnt를 update
      operationId: createDailyByDate
      parameters:
      - in: path
        name: date
        required: true
        schema:
          $ref: "#/components/schemas/daily/properties/date"
      requestBody:
        description: A JSON object containing updated(including origin) values to update daily
        content:
          application/json:
            schema:
              type: object
              properties:
                daily_context:
                  $ref: '#/components/schemas/daily/properties/daily_context'
      responses:
        200:
          description: Comment on daily successful
          content:
            application/json:
              schema:
                allOf:
                # - $ref: '#/components/schemas/daily'
                - type: object
                  description: 'response의 schema에만 표출됨'
                  properties:
                    date:
                      $ref: '#/components/schemas/daily/properties/date'
                    week:
                      $ref: '#/components/schemas/daily/properties/week'
                    month:
                      $ref: '#/components/schemas/daily/properties/month'
                    year:
                      $ref: '#/components/schemas/daily/properties/year'
                    user_id:
                      $ref: '#/components/schemas/daily/properties/user_id'
                    daily_context:
                      $ref: '#/components/schemas/daily/properties/daily_context'
                    cnt_schedule:
                      $ref: '#/components/schemas/daily/properties/cnt_schedule'
                    avg_point:
                      $ref: '#/components/schemas/schedule/properties/point'
                    avg_humidity:
                      $ref: '#/components/schemas/schedule/properties/humidity'
                    avg_illuminance:
                      $ref: '#/components/schemas/schedule/properties/illuminance'
                    avg_noise:
                      $ref: '#/components/schemas/schedule/properties/noise'
                    avg_temperature:
                      $ref: '#/components/schemas/schedule/properties/temperature'
                    schedules:
                      type: array
                      items:
                        $ref: '#/components/schemas/schedule'
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []
          
    # delete:
    #   tags:
    #   - average
    #   summary: Delete Comment on daily
    #   description: |-
    #     This can only be done by the logged in user
    #     본인의 일간의 만 삭제함
    #     잠시만여 daily를 삭제할 수 있나요?? 그 날의 schedule이 모두 삭제되었을 때 자동으로 삭제하도록 하는거면 몰라도,,,,,,
    #     애초에 삭제 버튼이 와이어프레임에 없었는데, 이건 없애는게 낫지 않을까요? 그냥 수정을 context 빈 상태로 하는 것이 삭제가 아닐지..../
    #     와이어프레임을 다시 보니 수정에 대한 내용도 없...
    #   operationId: deleteDailyByDate
    #   parameters:
    #   - in: path
    #     name: date
    #     required: true
    #     schema:
    #       $ref: "#/components/schemas/daily/properties/date"
    #   responses:
    #     200:
    #       description: Delete Comment on daily successful
    #       content: {}
    #     400:
    #       $ref: '#/components/responses/400'
    #   security:
    #   - JWT: []
          
  /average/weekly/{year}/{week}:
    get:
      tags:
      - average
      summary: Get weekly information
      description: |-
        * This can only be done by the logged in user
        * 본인의 주간만 가져옴
        * Y축이 각 일간 스케쥴의 개수인거죠?(시간의 합이 아니라...)
        * week에 대한 환경 등은 계산해서(avg) 돌려드리지만, array로 묶어서 보내는 그 하위단위인 daily에 대해서는 DB에 있는 그대로(cnt, sum) 전달드리겠습니다
      operationId: getWeeklyByWeek
      parameters:
      # - in: header
      #   name: user_id
      #   description: jwt 토큰 header["access_token"]를 뜯으면 payload에 있습니다
      #   schema:
      #     $ref: "#/components/schemas/user/properties/user_id"
      - in: path
        name: year
        required: true
        description: 주 단위의 값은 연도없이 조회가 불가하여 연도를 추가함
        schema:
          $ref: "#/components/schemas/schedule/properties/year"
      - in: path
        name: week
        required: true
        schema:
          $ref: "#/components/schemas/schedule/properties/week"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                allOf:
                # - $ref: '#/components/schemas/weekly'
                # ================================
                - type: object
                  properties:
                    week:
                      $ref: '#/components/schemas/daily/properties/week'
                    month:
                      $ref: '#/components/schemas/daily/properties/month'
                    year:
                      $ref: '#/components/schemas/daily/properties/year'
                    user_id:
                      $ref: '#/components/schemas/daily/properties/user_id'
                    cnt_schedule:
                      $ref: '#/components/schemas/daily/properties/cnt_schedule'
                    avg_point:
                      $ref: '#/components/schemas/schedule/properties/point'
                    avg_humidity:
                      $ref: '#/components/schemas/schedule/properties/humidity'
                    avg_illuminance:
                      $ref: '#/components/schemas/schedule/properties/illuminance'
                    avg_noise:
                      $ref: '#/components/schemas/schedule/properties/noise'
                    avg_temperature:
                      $ref: '#/components/schemas/schedule/properties/temperature'
                    # schedules:
                    #   type: array
                    #   items:
                    #     $ref: '#/components/schemas/schedule'
                    dailies:
                      type: array
                      items:
                        $ref: '#/components/schemas/daily'
                        # =================================
                        # type: object
                        # properties:
                        #   date:
                        #     $ref: '#/components/schemas/daily/properties/date'
                        #   cntschedule:
                        #     type: integer
                
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []
          
  /average/monthly/{date}:
    get:
      tags:
      - average
      summary: Get monthly information
      description: |-
        * This can only be done by the logged in user
        * 본인의 월간만 가져옴
        * month에 대한 환경 등은 계산해서(avg) 돌려드리지만, array로 묶어서 보내는 그 하위단위인 week에 대해서는 DB에 있는 그대로(cnt, sum) 전달드리겠습니다
      operationId: getMonthlyByMonth
      parameters:
      - in: path
        name: date
        required: true
        description: date 형식으로 받지만 년도, 월만 반영합니다
        schema:
          $ref: "#/components/schemas/schedule/properties/date"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                # $ref: '#/components/schemas/monthly'
                # ====================================
                allOf:
                - type: object
                  properties:
                    month:
                      $ref: '#/components/schemas/daily/properties/month'
                    year:
                      $ref: '#/components/schemas/daily/properties/year'
                    user_id:
                      $ref: '#/components/schemas/daily/properties/user_id'
                    cnt_schedule:
                      $ref: '#/components/schemas/daily/properties/cnt_schedule'
                    avg_point:
                      $ref: '#/components/schemas/schedule/properties/point'
                    avg_humidity:
                      $ref: '#/components/schemas/schedule/properties/humidity'
                    avg_illuminance:
                      $ref: '#/components/schemas/schedule/properties/illuminance'
                    avg_noise:
                      $ref: '#/components/schemas/schedule/properties/noise'
                    avg_temperature:
                      $ref: '#/components/schemas/schedule/properties/temperature'
                - type: object
                  properties:
                    weeklies:
                      type: array
                      items:
                        $ref: '#/components/schemas/weekly'
                        # =================================
                        # type: object
                        # properties:
                        #   week:
                        #     $ref: '#/components/schemas/weekly/properties/week'
                        #   cntdaily:
                        #     type: integer
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []
          
  /average/yearly/{year}:
    get:
      tags:
      - average
      summary: Get yearly information
      description: |-
        * This can only be done by the logged in user
        * 본인의 연간만 가져옴
        * year에 대한 환경 등은 계산해서(avg) 돌려드리지만, array로 묶어서 보내는 그 하위단위인 month에 대해서는 DB에 있는 그대로(cnt, sum) 전달드리겠습니다
      operationId: getYearlyByYear
      parameters:
      - in: path
        name: year
        required: true
        schema:
          $ref: "#/components/schemas/yearly/properties/year"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                # $ref: '#/components/schemas/yearly'
                # ====================================
                allOf:
                # - $ref: '#/components/schemas/yearly'
                - type: object
                  properties:
                    year:
                      $ref: '#/components/schemas/daily/properties/year'
                    user_id:
                      $ref: '#/components/schemas/daily/properties/user_id'
                    cnt_schedule:
                      $ref: '#/components/schemas/daily/properties/cnt_schedule'
                    avg_point:
                      $ref: '#/components/schemas/schedule/properties/point'
                    avg_humidity:
                      $ref: '#/components/schemas/schedule/properties/humidity'
                    avg_illuminance:
                      $ref: '#/components/schemas/schedule/properties/illuminance'
                    avg_noise:
                      $ref: '#/components/schemas/schedule/properties/noise'
                    avg_temperature:
                      $ref: '#/components/schemas/schedule/properties/temperature'
                    monthlies:
                      type: array
                      items:
                        $ref: '#/components/schemas/monthly'
                        # =================================
                        # type: object
                        # properties:
                        #   month:
                        #     $ref: '#/components/schemas/monthly/properties/month'
                        #   cntdaily:
                        #     type: integer
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []
      
  /group:
  
    post:
      tags:
      - group
      summary: create new group
      description: |-
        * /group/namevalidation 을 통해 그룹명이 겹치지 않는지 중복확인 된 경우에만 요청을 보내주세요.
        * 그룹을 생성한 사람이 자동적으로 첫 회원이자 그룹 관리자가 됩니다
        * 모든 그룹 목록을 보여주는 `GET /group` 도 만들 수 있지만 `POST /group/search`에 q를 공란으로 보내는 것과 마찬가지라 다시 구현하지 않겠습니다.
      operationId: createGroup
      # https://swagger.io/docs/specification/describing-request-body/
      requestBody:
        description: A JSON object containing values to create new group
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  $ref: '#/components/schemas/group/properties/name'
                context:
                  $ref: '#/components/schemas/group/properties/context'
                # 두 개 이상의 필수적인 inheritance는 왜 작동을 안하지: 해결
                  # type: string
                  # format: varchar
                  # type: string
                  # format: text
      responses:
        200:
          $ref: '#/components/responses/200group'
      security:
      - JWT: []
      
  /group/namevalidation:
  
    post:
      tags:
      - group
      summary: |-
        그룹 생성시 그룹 이름 중복 확인
      description: check if there is a group in that name so that it doesn't override
      operationId: checkGroupName
      # parameters:
      # - in: path
      #   name: name
      #   required: true
      #   schema:
      #     $ref: '#/components/schemas/group/properties/name'
      requestBody:
        content:
          application/json:
            schema:
              properties:
                name:
                  $ref: '#/components/schemas/group/properties/name'
      responses:
        200:
          description: "true면 해당 이름의 그룹이 존재하므로, 중복 방지를 위해 거절"
          content:
            application/json:
              schema:
                type: object
                properties:
                  found:
                    type: boolean
      security:
      - JWT: []                    
                    
  /group/{group_id}:
  
    get:
      tags:
      - group
      summary: get group by group_id
      operationId: getGroupById
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      responses:
        200:
          description: Group found(includes list of members)
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/group'
                - type: object
                  properties:
                    members:
                      type: array
                      items:
                        allOf:
                          - $ref: '#/components/schemas/user'
                          - type: object
                            # required:
                            # - joined_at
                            # - is_groupadmin
                            properties:
                              joined_at:
                                type: string
                                format: date-time
                              is_group_admin:
                                type: boolean
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []          
          
    put:
      tags:
      - group
      summary: update group by group_id
      description: |-
        * FE에서 name, context 정도만 변경하는 요청 보내올 것 같습니다
        * group에 변동사항(회원추가, 탈퇴 등)이 발생하면 BE에서 업데이트해줘야할 것 같습니다
      operationId: updateGroupById
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      # https://swagger.io/docs/specification/describing-request-body/
      requestBody:
        description: A JSON object containing updated values
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/group'
      responses:
        200:
          description: group updated
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/group'
                - type: object
                  properties:
                    members:
                      type: array
                      items:
                        allOf:
                          - $ref: '#/components/schemas/user'
                          - type: object
                            # required:
                            # - joined_at
                            # - is_groupadmin
                            properties:
                              joined_at:
                                type: string
                                format: date-time
                              is_group_admin:
                                type: boolean
        400:
          $ref: '#/components/responses/400'
      security:
      - JWT: []
      
    delete:
      tags:
      - group
      summary: delete group by group_id
      operationId: deleteGroupById
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      responses:
        200:
          description: group deleted
          content: {}
        400:
          description: 400error
          content: {}
      security:
      - JWT: []
      
  /group/search:
  
    post:
      tags:
      - group
      summary: search group
      operationId: getGroupsBySearch
      description: |-
        * 검색 내용을 보내면 해당되는 그룹들을 반환한다. 
        * 이때 검색하는 대상은 name, context로 한다. (이외에 찾을게 있나요???)
        * url경로로 한글, 특수문자도 전달되면 그냥 get, query parameter로 받아도 될 것 같은데 확인 필요.
        * response에서 그룹의 멤버도 검색했을 때 필요할까요??? 0813 합의로 어디에선가 필요하긴 하지만, 여기말고 GET /user/user_id에서 구현하기로 했습니다. 그래서 업데이트로 주석처리하였습니다.
      requestBody:
        description: "검색어"
        content:
          application/json:
            schema:
              type: object
              properties:
                q:
                  type: string
      # parameters:
      # - in: query
      #   required: true
      #   name: q
      #   schema:
      #     type: string
      responses:
        200:
          description: groups found
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/group'
                # - type: object
                #   properties:
                #     members:
                #       type: array
                #       items:
                #         allOf:
                #           - $ref: '#/components/schemas/user'
                #           - type: object
                #             # required:
                #             # - joined_at
                #             # - is_groupadmin
                #             properties:
                #               joined_at:
                #                 type: string
                #                 format: date-time
                #               is_group_admin:
                #                 type: boolean
        400:
          $ref: '#/components/responses/400'
        401:
          $ref: '#/components/responses/401'
        404:
          $ref: '#/components/responses/404'
      security:
      - JWT: []          
      
  /group/{group_id}/applicant:
    get:
      tags:
      - group
      summary: get applicants to specific group(for group_admin)
      description: |-
        * group_id에 해당하는 그룹에 가입신청을 한 가입신청자를 반환합니다(그룹 관리자용 화면)
        * 해당 그룹의 관리자인지 확인합니다.
      operationId: getApplicants
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      responses:
        200:
          description: 'Successful'
          content:
            application/json:
              schema:
                type: array
                items:
                  allOf:
                    - $ref: '#/components/schemas/user'
                    - type: object
                      properties:
                        applied_at:
                          type: string
                          format: date-time
                        reason:
                          type: string
                          example: 'IoT하고 싶어요...'
        400:
          description: 'Bad request'
      security:
      - JWT: []          
          
    post:
      tags:
      - group
      summary: applicant asks to join specific group(for applicant)
      description: |-
        * group_id에 해당하는 그룹에 회원이 가입신청을 합니다
        * 가입신청이 되었다는 뜻으로 200을, 오류 발생시 400을 반환합니다.
      operationId: createApplicant
      requestBody:
        content:
          application/json:
            schema:
              properties:
                reason:
                  type: string
                  example: 'IoT하고 싶어요...'
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      responses:
        200:
          description: 'Successful'
        400:
          description: 'Bad request'
      security:
      - JWT: []          
      
    delete:
      tags:
      - group
      summary: applicant retrieves application to join specific group(for applicant)
      description: |-
        * group_id에 해당하는 그룹에 회원이 가입신청 했던 것을 취소합니다.
        * 가입신청 취소가 되었다는 뜻으로 200을, 오류 발생시(신청한 적 없다던지) 400을 반환합니다.
      operationId: deleteApplicant
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      responses:
        200:
          description: 'Successful'
        400:
          description: 'Bad request'
      security:
      - JWT: []
      
  /group/{group_id}/applicant/{user_id}:
  
    post:
      tags:
      - group
      summary: approves applicant (for group admin)
      description: |-
        * group_id에 해당하는 그룹에 가입신청한 회원을 승인합니다.
        * 승인이 되었다(가입신청자 명단에서 삭제)는 뜻으로 200을, 오류 발생시 400을 반환합니다.
        * `BE` applicant테이블에서 삭제하고, usersmngroups에 추가합니다.
      operationId: createMemberById
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      - in: path
        required: true
        name: user_id
        schema:
          $ref: '#/components/schemas/user/properties/user_id'
      responses:
        200:
          description: 'Successful'
        400:
          description: 'Bad request'
      security:
      - JWT: []          
      
    delete:
      tags:
      - group
      summary: declines applicant (for group admin)
      description: |-
        * group_id에 해당하는 그룹에 가입신청한 회원을 거절합니다.
        * 거절이 되었다(가입신청자 명단에서 삭제)는 뜻으로 200을, 오류 발생시 400을 반환합니다.
      operationId: deleteApplicantById
      parameters:
      - in: path
        required: true
        name: group_id
        schema:
          $ref: '#/components/schemas/group/properties/group_id'
      - in: path
        required: true
        name: user_id
        schema:
          $ref: '#/components/schemas/user/properties/user_id'
      responses:
        200:
          description: 'Successful'
        400:
          description: 'Bad request'
      security:
      - JWT: []          
      

      
  /trophy:
  
    post:
      tags:
      - trophy
      summary: 트로피를 만듭니다. (관리자 페이지용)
      description: |-
        * 트로피를 만듭니다.
        * 하지만 이걸 만들었다해서 회원 각각이 얻는 로직이 구현된 것은 아닙니다.
        * 그러니 그냥 SQL로 직접 DB에 반영하는거랑 크게 차이가 없습니다.
      operationId: createTrophy
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/trophy'
      responses:
        200:
          description: 'Successful'
        400:
          description: 'Bad Request'
      security:
      - JWT: []
      
    get:
      tags:
      - trophy
      summary: 모든 트로피를 조회합니다. 
      description: |-
        * 얻을 수 있는 모든 트로피를 반환합니다.
        * 단순히 서비스상의 기능을 보여주므로 로그인할 필요가 없다고 느껴집니다.
      operationId: getTrophyAll
      responses:
        200:
          description: 'Successful'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/trophy'
        400:
          description: 'Bad Request'
      # security:
      # - JWT: []
      
  /trophy/user:
  
    get:
      tags:
      - trophy
      summary: '[TEST] 모든 유저-트로피 관계를 조회합니다.'
      description: |-
        * 모든 유저가 획득한 모든 트로피 관계를 반환합니다.
        * DB에 있는 걸 전부 가져옵니다.
        * 테스트용입니다
        * user와 trophy를 join해서 가져오는 것도 (힘들지만) 가능합니다.
      operationId: getUserTrophyAll
      responses:
        200:
          description: OK
          
  
  
  
  /trophy/user/{user_id}:
  
    get:
      tags:
      - trophy
      summary: gets array of trophy gained by user(user_id)
      description: |-
        * user_id에 해당하는 회원이 보유한 트로피들을 반환합니다.
        * 회원에 대한 상세한 검색을 하는 경우에는 트로피의 정보도 필요할 것으로 보인다
        * 그러므로 트로피 정보를 join한 형태로 반환함
        * jwt토큰을 굳이 안받아도 user_id가 있다. 만약 다른 사람의 트로피를 조회하는거일수도 있고.
      operationId: getUserTrophiesById
      parameters:
      - in: path
        required: true
        name: user_id
        schema:
          $ref: '#/components/schemas/user/properties/user_id'
      responses:
        200:
          description: 'Successful'
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/mytrophy'
        400:
          description: 'Bad Request'
      # security:
      # - JWT: []
      
  /trophy/{trophy_id}/user/{user_id}:
      
    post:
      tags:
      - trophy
      summary: adds trophy to user(user_id)
      description: |-
        * user_id에 해당하는 회원이 trophy_id에 해당하는 트로피를 얻습니다.
        * 성공적으로 추가된 경우 200, 오류 발생시 400 코드를 반환합니다.
      operationId: createUserTrophyById
      parameters:
      - in: path
        required: true
        name: user_id
        schema:
          $ref: '#/components/schemas/user/properties/user_id'
      - in: path
        required: true
        name: trophy_id
        schema:
          $ref: '#/components/schemas/trophy/properties/trophy_id'
      responses:
        200:
          description: 'Successful'
        400:
          description: 'Bad Request'
      security:
      - JWT: []
      
      
      
components:

  schemas:
        
    schedule:
      # required:
      # - schedule_id
      type: object
      description: '시작예정/마감예정/실제시작/실제완료'
      properties:
        schedule_id:
          type: integer
        user_id:
          $ref: '#/components/schemas/user/properties/user_id'
        date:
          type: string
          format: date
          example: '2021-08-08'
          # $ref: '#/components/schemas/daily/properties/date'
        week:
          type: string
          format: week
          description: moment().isoweek()로 1년의 몇번째 주(weekofyear)인지 구할 수 있습니다
        month:
          type: string
          format: month
          description: moment().메서드로 1년의 몇번째 월인지 구할 수 있습니다
        year:
          type: string
          format: year
          description: 솔직히 연단위까지 필요한가 싶지만... 일단 넣어봅시다
        title:
          type: string
          format: varchar
        context:
          type: string
          format: text
        expectstart_at:
          type: string
          description: 설정 시작시간
          format: date-time
        started_at:
          type: string
          description: 실제 시작시간
          format: date-time
        finished_at:
          type: string
          description: 실제로 완료한 시간
          format: date-time
        deadline_at:
          type: string
          description: 설정 마감일시
          format: date-time
        created_at:
          type: string
          description: 이 일정이 등록된 시간
          format: date-time
        updated_at:
          type: string
          description: 이 일정이 마지막으로 수정된 시간
          format: date-time
        point:
          type: integer
          description: 100점 만점으로 0~100의 integer형으로 송수신바랍니다
        is_finished:
          type: boolean
          default: false
        notification:
          type: boolean
          description: true면 일정에 대한 알림이 존재, false는 존재하지 않음
        notificationtime:
          type: string
          format: date-time
          description: 알림이 있는 경우에는 date-time 형식으로, 없는 경우에는 0값으로(혹은 특정한 시간으로?)
          # example: "2021-07-27T05:20:48.682Z"
        noti_extend:
          type: integer
          description: 알림을 연장한 횟수
        # 0803 회의 결과 nosql도입이전까지 평균 환경변수는 최소단위가 일정으로 1:1 관계로 두기보다 어트리뷰트로 합치기로 하였음
        humidity:
          type: integer
          description: 습도
        illuminance:
          type: integer
          description: 조도
        noise:
          type: integer
          description: 소음
        temperature:
          type: integer
          description: 온도          
        
  
    user:
      # required:
      # - user_id
      type: object
      description: 회원의 트로피와 그룹 가입 정보를 모델에 넣을 경우 group>user>mygroup>group 재귀의 시작이라 제거했으며 get 요청으로 가져오는 경우에 포함되도록 설계했습니다
      properties:
        user_id:
          type: string
          format: varchar(20)
          example: honggildong1!
        name:
          type: string
          example: 홍길동1!
        email:
          type: string
          example: hong1@korea.kr
        cellphone:
          type: string
          example: 010-1234-5678
        password:
          type: string
          example: "abcd1234!@#$"
        exp:
          type: integer
        is_admin:
          type: boolean
          description: |-
            true: admin,
            false: not admin,
            이때의 admin은 사이트 전체를 의미함, group_admin과 다름
          default: false
        created_at:
          type: string
          format: date-time
        # 아래 array도 user에 필수적인 것 같지는 않은데,,, group>user>mygroup>group 재귀의 시작이라 제거
        # mytrophies:
        #   description: 회원이 소유한 트로피만 반환한다
        #   type: array
        #   items:
        #     $ref: '#/components/schemas/mytrophy'
        # mygroups:
        #   description: 회원이 속한 그룹만 반환한다
        #   type: array
        #   items:
        #     $ref: '#/components/schemas/group'
          
    daily:
      description: 하루 정리?하는 화면. JSON크기를 줄일 방법을 찾자.  / environment.created_at은 어느시점을 넣어놓을까
      # required:
      # - date
      type: object
      properties:
        date:
          $ref: '#/components/schemas/schedule/properties/date'
          # type: string
          # format: date
        week:
          $ref: '#/components/schemas/schedule/properties/week'
        month:
          $ref: '#/components/schemas/schedule/properties/month'
        year:
          $ref: '#/components/schemas/schedule/properties/year'
        user_id:
          $ref: '#/components/schemas/user/properties/user_id'
        daily_context:
          type: string
          format: text
          example: 오늘은 너무 피곤했ㄷr....
        cnt_schedule:
          type: integer
          description: 해당 날짜의 schedule의 갯수입니다. 마찬가지로 update마다 계산필요.
        sum_point:
          type: integer
          description: 해당 날짜의 schedule이 update(post/put)될때마다 계산해준다
        sum_humidity:
          $ref: '#/components/schemas/schedule/properties/humidity'
        sum_illuminance:
          $ref: '#/components/schemas/schedule/properties/illuminance'
        sum_noise:
          $ref: '#/components/schemas/schedule/properties/noise'
        sum_temperature:
          $ref: '#/components/schemas/schedule/properties/temperature'
        # 모델이 schedule을 포함하는 것이 아니라 response에서 섞어서 보내주는걸로
        # schedules:
        #   type: array
        #   items:
        #     $ref: '#/components/schemas/schedule'
        
          
    weekly:
      description: 주간 내용을 보여주는데 주를 판별하는 방법은??? moment weekofyear를 사용할 수 있을 것 같다. / environment.created_at은 어느시점을 넣어놓을까
      # required:
      # - week
      type: object
      properties:
        week:
          $ref: '#/components/schemas/schedule/properties/week'
          # type: string
          # format: date
          # description: week를 date로 할지, 그냥 string형으로 할지, 기간을 잡을지...
        month:
          $ref: '#/components/schemas/schedule/properties/month'
        year:
          $ref: '#/components/schemas/schedule/properties/year'
        user_id:
          $ref: '#/components/schemas/user/properties/user_id'
        cnt_schedule:
          type: integer
          description: 해당 날짜의 schedule의 갯수입니다. 마찬가지로 update마다 계산필요.
        sum_point:
          type: integer
          description: 해당 날짜의 schedule이 update(post/put)될때마다 계산해준다
        sum_humidity:
          $ref: '#/components/schemas/schedule/properties/humidity'
        sum_illuminance:
          $ref: '#/components/schemas/schedule/properties/illuminance'
        sum_noise:
          $ref: '#/components/schemas/schedule/properties/noise'
        sum_temperature:
          $ref: '#/components/schemas/schedule/properties/temperature'
        # 모델이 daily를 포함하는 것이 아니라 response에서 섞어서 보내주는걸로
        # dailies:
        #   type: array
        #   items:
        #     $ref: '#/components/schemas/daily'
        
          
    monthly:
      description: 월간 내용을 보여주는데 다행히 월은 기준이 있다
      # required:
      # - month
      type: object
      properties:
        month:
          $ref: '#/components/schemas/schedule/properties/month'
        year:
          $ref: '#/components/schemas/schedule/properties/year'        
        user_id:
          $ref: '#/components/schemas/user/properties/user_id'
        cnt_schedule:
          type: integer
          description: 해당 날짜의 schedule의 갯수입니다. 마찬가지로 update마다 계산필요.
        sum_point:
          type: integer
          description: 해당 날짜의 schedule이 update(post/put)될때마다 계산해준다
        sum_humidity:
          $ref: '#/components/schemas/schedule/properties/humidity'
        sum_illuminance:
          $ref: '#/components/schemas/schedule/properties/illuminance'
        sum_noise:
          $ref: '#/components/schemas/schedule/properties/noise'
        sum_temperature:
          $ref: '#/components/schemas/schedule/properties/temperature'
        # 모델이 weekly를 포함하는 것이 아니라 response에서 섞어서 보내주는걸로
        # weeklies:
        #   type: array
        #   items:
        #     $ref: '#/components/schemas/weekly'
      
    yearly:
      description: 연간 내용을 보여준다
      # required:
      # - year
      type: object
      properties:
        year:
          type: string
          format: year
        user_id:
          $ref: '#/components/schemas/user/properties/user_id'
        cnt_schedule:
          type: integer
          description: 해당 날짜의 schedule의 갯수입니다. 마찬가지로 update마다 계산필요.
        sum_point:
          type: integer
          description: 해당 날짜의 schedule이 update(post/put)될때마다 계산해준다
        sum_humidity:
          $ref: '#/components/schemas/schedule/properties/humidity'
        sum_illuminance:
          $ref: '#/components/schemas/schedule/properties/illuminance'
        sum_noise:
          $ref: '#/components/schemas/schedule/properties/noise'
        sum_temperature:
          $ref: '#/components/schemas/schedule/properties/temperature'
        # 모델이 monthly를 포함하는 것이 아니라 response에서 섞어서 보내주는걸로
        # monthlies:
        #   type: array
        #   items:
        #     $ref: '#/components/schemas/monthly'
        

    group:
      type: object
      description: user 목록이 필요한데, user 내에 가입한 그룹도 표시되기 때문에 재귀적임. 어디에선가는 그 재귀를 끊어야할텐데. DB에는 group 테이블에 이정도만 남기겠습니다. 나머지는 MM관계를 통해 형성하시길...
      properties:
        group_id:
          type: integer
        name:
          type: string
          format: varchar()
          example: woorigroup
        context:
          type: string
          format: text
          example: 이것은 테스트하기 위한 우리의 그룹이므로 우리그룹이라 했지만 우리은행에 간 게 부럽다는 걸 표현하는 것은 절대 아니며
            그냥 string을 text 형태로 받으면 어떻게 프론트엔드에서 표현하실지 궁금해서 굳이 길게 쓰고 있는 중입니다.123
        pax:
          type: integer
          description: amount of person in this group
        ranking:
          type: integer
          description: ranking of group between all groups, based on WHAT???
          example: 40
        created_at:
          type: string
          format: date-time
          # example: '2021-07-24T06:38:22.326Z'
        # DB기준으로 M:M관계이기에 group에 포함하기보다는 get했을 때 query로 받아오는 방식 
        # members:
        #   type: array
        #   description: user의 모든 속성과 가입/관리자 속성을 합치고 싶었는데... mytrohpy 참조해서 성공!
        #   items:
        #     allOf:
        #       - $ref: '#/components/schemas/user'
        #       - type: object
        #         # required:
        #         # - joined_at
        #         # - is_groupadmin
        #         properties:
        #           joined_at:
        #             type: string
        #             format: date-time
        #           is_groupadmin:
        #             type: boolean
        
    # 만들다보니 너무 더러워서 그냥 직접 requestBody에 작성
    # creategroupdata:
    #   allOf:
    #   - $ref: "#/components/schemas/group/properties/name"
    #   - $ref: "#/components/schemas/group/properties/context"
        
          
    trophy:
      type: object
      properties:
        trophy_id:
          type: integer
        title:
          type: string
          format: varchar
          example: 출석장인
        context:
          type: string
          format: varchar
          example: 10일 이상 출석합니다
        is_hidden:
          type: boolean
          description: 트로피가 회원에게 달성이전에도 보여지는지 정합니다
        exp:
          type: integer
          description: 해당 트로피를 획득시 회원이 얻게되는 경험치
        img:
          type: string
          description: 트로피의 픽토그램이나 이미지의 경로입니다(링크/파일 미정)
          format: url
      # mytrophy로 상속을 위해 필요..하지 않다 https://swagger.io/docs/specification/data-models/oneof-anyof-allof-not/
      # discriminator:
      #   propertyName: mytrophy
        
    mytrophy:
      description: 'API 설계하면서 계속 쓰기 귀찮아서 이렇게 한 것일뿐, 실제로 DB에 이렇게 되어있지 않습니다'
      allOf:
        - $ref: '#/components/schemas/trophy'
        - type: object
          properties:
            is_achieved:
              type: boolean
            achieved_at:
              type: string
              format: date-time
        
    environment:
      type: object
      description: 아직 센서의 측정값을 모르기 때문에 섣불리 하기 힘들다
      properties:
        humidity:
          type: integer
          description: 습도
        illuminance:
          type: integer
          description: 조도
        noise:
          type: integer
          description: 소음
        temperature:
          type: integer
          description: 온도
        # created_at:
        #   type: string
        #   description: 측정된 시각
        #   format: date-time
          
    error:
      type: object
      # required:
      #   - code
      #   - message
      properties:
        code:
          type: string
          example: '400'
        message:
          type: string
          example: 'Bad Request'
          
    JWT:
      type: object
      description: JWT이 어떻게 생겼는지 궁금하실 분들은 위해 header["access_token"]를 뜯으면 나오는 payload부분을 보여드립니다.
      properties:
        user_id:
          $ref: '#/components/schemas/user/properties/user_id'
          # type: string
        iat:
          type: integer
          example: 1628155053
          description: IOS표준에 따라 변환 필요합니다
        exp:
          type: integer
          example: 1628241453
          description: IOS표준에 따라 변환 필요합니다
          
  responses:
    # description: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status
    
    200user:
      description: OK
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/user'

    200schedule:
      description: OK
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/schedule'
    
    200group:
      description: OK
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/group'

    
    400jwt:
      description: Bad Request
      content:
        application/json:
          schema:
            properties:
              name:
                type: string
                example: "JsonWebTokenError"
              message:
                type: string
                example: "invalid signature"

            
    400:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error'
            
    401:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error'
            
    404:
      description: Not Found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/error'
        
    # ApiResponse:
    #   type: object
    #   properties:
    #     code:
    #       type: integer
    #       format: int32
    #       example:
    #       - "404"
    #       - "400"
    #     type:
    #       type: string
    #     message:
    #       type: string
          
  securitySchemes:
  
    JWT:
      type: apiKey
      name: access_token
      in: header
      
    # schedulestore_auth:
    #   type: oauth2
    #   flows:
    #     implicit:
    #       authorizationUrl: http://schedulestore.swagger.io/oauth/dialog
    #       scopes:
    #         write:schedules: modify schedules in your account
    #         read:schedules: read your schedules
            
    # api_key:
    #   type: apiKey
    #   name: api_key
    #   in: header
